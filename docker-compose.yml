# mindtrace

services:
  # PostgreSQL
  db:
    image: postgres:17-alpine  # Usa a imagem oficial do Postgres, versão 15, baseada em Alpine (leve)
    container_name: mindtrace-db
    restart: always # Sempre reinicia o container se ele parar
    environment:
      - POSTGRES_USER=${POSTGRES_USER}      # Usuário do banco
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}  # Senha do banco
      - POSTGRES_DB=${POSTGRES_DB}    # Nome do banco de dados a ser criado
    ports:
      - "5432:5432" # Mapeia a porta 5432 do seu PC para a porta 5432 do container
    volumes:
      - ./postgres-data:/var/lib/postgresql/data # Persiste os dados do banco na pasta 'postgres-data' no seu PC
  pgadmin:
    image: dpage/pgadmin4
    container_name: pgadmin-server
    ports:
      - "8001:80"
    environment:
      - PGADMIN_DEFAULT_EMAIL=admin@admin.com
      - PGADMIN_DEFAULT_PASSWORD=admin
      - PGADMIN_LISTEN_ADDRESS=0.0.0.0
    depends_on:
      - db
    # Serviço do Backend em Go
  backend:
    container_name: mindtrace-backend
    build:
      context: ./backend # O Docker vai procurar o Dockerfile na pasta 'backend'
    restart: always
    ports:
      - "8080:8080" # Mapeia a porta 8080 do PC para a 8080 do container
    environment:
      # Variáveis para a sua API Go se conectar ao banco
      - DB_USER=${POSTGRES_USER}      # Usuário do banco
      - DB_PASSWORD=${POSTGRES_PASSWORD}  # Senha do banco
      - DB_DB=${POSTGRES_DB} 
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - db # Garante que o container do 'db' inicie antes do 'backend'
  ## DESCOMENTE PARA PRODUCAO / COMENTE PARA DESENVOLVIMENTO
  # Serviço do Frontend em Vue.js
  # frontend:
  #   container_name: mindtrace-frontend
  #   build:
  #     context: ./frontend
  #   restart: always
  #   ports:
  #     - "8000:80" # Mapeia a porta 80 do PC para a 80 do container (Nginx)
  #   depends_on:
  #     - backend # Opcional, mas bom para garantir que a API esteja de pé
  ## COMENTE PARA PRODUCAO / DESCOMENTE PARA DESENVOLVIMENTO (HOT RELOAD)
  frontend:
    container_name: mindtrace-frontend
    image: node:22.17.1-alpine
    working_dir: /app
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - "5173:5173" # Porta padrão do Vite
    command: sh -c "npm install && npm run dev -- --host"
    depends_on:
      - backend

volumes:
  postgres-data: